version: 2.1

jobs:
  build_and_test_branch:
    docker:
      - image: cimg/python:3.8  # Use the cimg namespace for Python 3.8
    steps:
      - checkout

      - run:
          name: DETERMINE BUILD TAG BASED ON BRANCH
          command: |
            # Get the branch name
            branch_name=$(echo ${CIRCLE_BRANCH} | sed 's/\//-/g')  # Replace slashes with dashes
            
            # Conditional logic to set the appropriate tag
            if [ "$CIRCLE_BRANCH" == "master" ]; then
              tag="Master"
            elif [ "$CIRCLE_BRANCH" == "staging" ]; then
              tag="Staging"
            else
              tag="Feature-${branch_name}"
            fi

            # Print the determined tag for debugging
            echo "Build Tag: ${tag}"

            # Optionally, set the tag as an environment variable
            echo "export BUILD_TAG=${tag}" >> $BASH_ENV
      
workflows:
  version: 2
  build_and_test:
    jobs:
      - build_and_test_branch:
          filters:
            branches:
              only:
                - master
                - staging
                - feature/test-branch  # Include other branches as needed
